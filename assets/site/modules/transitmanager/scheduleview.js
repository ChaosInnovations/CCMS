var points1a = [{lat:48.77904,lng:-123.28043},{lat:48.77955,lng:-123.2804},{lat:48.78071,lng:-123.28046},{lat:48.78166,lng:-123.28055},{lat:48.78178,lng:-123.28052},{lat:48.78185,lng:-123.28033},{lat:48.78192,lng:-123.2802},{lat:48.78193,lng:-123.28015},{lat:48.78194,lng:-123.28011},{lat:48.78195,lng:-123.28007},{lat:48.78199,lng:-123.27928},{lat:48.78199,lng:-123.27925},{lat:48.78201,lng:-123.27919},{lat:48.78204,lng:-123.27912},{lat:48.78208,lng:-123.27909},{lat:48.78211,lng:-123.27908},{lat:48.78214,lng:-123.27908},{lat:48.78218,lng:-123.27909},{lat:48.78223,lng:-123.27911},{lat:48.78229,lng:-123.27916},{lat:48.78358,lng:-123.28029},{lat:48.78378,lng:-123.28044},{lat:48.78409,lng:-123.28075},{lat:48.78605,lng:-123.28541},{lat:48.78607,lng:-123.28544},{lat:48.78609,lng:-123.28547},{lat:48.78614,lng:-123.28551},{lat:48.78619,lng:-123.28555},{lat:48.78626,lng:-123.28558},{lat:48.78683,lng:-123.28568},{lat:48.79097,lng:-123.28575},{lat:48.79109,lng:-123.28575},{lat:48.79126,lng:-123.28571},{lat:48.79131,lng:-123.28568},{lat:48.79138,lng:-123.28563},{lat:48.79201,lng:-123.28491},{lat:48.79211,lng:-123.28483},{lat:48.79218,lng:-123.28479},{lat:48.79241,lng:-123.28467},{lat:48.79377,lng:-123.28427},{lat:48.79517,lng:-123.28371},{lat:48.79603,lng:-123.28333},{lat:48.7962,lng:-123.28324},{lat:48.79629,lng:-123.28318},{lat:48.79636,lng:-123.28311},{lat:48.79664,lng:-123.2828},{lat:48.79689,lng:-123.28249},{lat:48.79699,lng:-123.28235},{lat:48.7971,lng:-123.28221},{lat:48.79726,lng:-123.28205},{lat:48.7974,lng:-123.28192},{lat:48.79751,lng:-123.28183},{lat:48.79767,lng:-123.28177},{lat:48.79881,lng:-123.28135},{lat:48.799,lng:-123.28119},{lat:48.79936,lng:-123.28075},{lat:48.79969,lng:-123.28197},{lat:48.80039,lng:-123.28398},{lat:48.80065,lng:-123.28559},{lat:48.80138,lng:-123.28568},{lat:48.80163,lng:-123.28569},{lat:48.80184,lng:-123.28569},{lat:48.80356,lng:-123.28573},{lat:48.80495,lng:-123.28565},{lat:48.80538,lng:-123.28688},{lat:48.80592,lng:-123.28906},{lat:48.8069,lng:-123.29408},{lat:48.80855,lng:-123.30088},{lat:48.80929,lng:-123.30385},{lat:48.81038,lng:-123.30733},{lat:48.81118,lng:-123.31127},{lat:48.81125,lng:-123.31192},{lat:48.8113,lng:-123.31233},{lat:48.81148,lng:-123.31312},{lat:48.8121,lng:-123.31499},{lat:48.81218,lng:-123.31514},{lat:48.81227,lng:-123.31524},{lat:48.8125,lng:-123.31547},{lat:48.8126,lng:-123.31558},{lat:48.81266,lng:-123.31567},{lat:48.81285,lng:-123.31608},{lat:48.81229,lng:-123.31576},{lat:48.81215,lng:-123.31573},{lat:48.81209,lng:-123.31574},{lat:48.81195,lng:-123.3158},{lat:48.81189,lng:-123.31586},{lat:48.81168,lng:-123.31612},{lat:48.81143,lng:-123.31648},{lat:48.81072,lng:-123.31687},{lat:48.81029,lng:-123.3177},{lat:48.81011,lng:-123.31782},{lat:48.80991,lng:-123.31778},{lat:48.80941,lng:-123.31726},{lat:48.8092,lng:-123.31675},{lat:48.80883,lng:-123.31533},{lat:48.8088,lng:-123.3152},{lat:48.80845,lng:-123.31376},{lat:48.80836,lng:-123.31342},{lat:48.8083,lng:-123.31325},{lat:48.80738,lng:-123.31092},{lat:48.80458,lng:-123.31018},{lat:48.80383,lng:-123.31},{lat:48.80371,lng:-123.30996},{lat:48.80362,lng:-123.30991},{lat:48.80354,lng:-123.30986},{lat:48.80348,lng:-123.30979},{lat:48.80344,lng:-123.30973},{lat:48.80338,lng:-123.30961},{lat:48.80278,lng:-123.30792},{lat:48.80269,lng:-123.3077},{lat:48.80261,lng:-123.30752},{lat:48.80255,lng:-123.30742},{lat:48.80246,lng:-123.30732},{lat:48.80127,lng:-123.30631},{lat:48.80119,lng:-123.30626},{lat:48.80095,lng:-123.30622},{lat:48.80103,lng:-123.30645},{lat:48.80102,lng:-123.30671},{lat:48.8009,lng:-123.30721},{lat:48.80086,lng:-123.30743},{lat:48.8008,lng:-123.30774},{lat:48.80072,lng:-123.30876},{lat:48.80065,lng:-123.30921},{lat:48.80061,lng:-123.30944},{lat:48.8006,lng:-123.30963},{lat:48.80066,lng:-123.30997},{lat:48.80085,lng:-123.31074},{lat:48.80091,lng:-123.31114},{lat:48.80101,lng:-123.31151},{lat:48.80109,lng:-123.3118},{lat:48.8019,lng:-123.31389},{lat:48.80202,lng:-123.3152},{lat:48.80205,lng:-123.31561},{lat:48.80205,lng:-123.31576},{lat:48.80203,lng:-123.31591},{lat:48.80201,lng:-123.31601},{lat:48.80198,lng:-123.31608},{lat:48.80195,lng:-123.31612},{lat:48.80191,lng:-123.31615},{lat:48.80183,lng:-123.31619},{lat:48.80174,lng:-123.31621},{lat:48.80167,lng:-123.3162},{lat:48.8016,lng:-123.31618},{lat:48.80153,lng:-123.31613}];
var points1b = [{lat:48.80149,lng:-123.31608},{lat:48.80153,lng:-123.31613},{lat:48.8016,lng:-123.31618},{lat:48.80167,lng:-123.3162},{lat:48.80174,lng:-123.31621},{lat:48.80183,lng:-123.31619},{lat:48.80191,lng:-123.31615},{lat:48.80195,lng:-123.31612},{lat:48.80198,lng:-123.31608},{lat:48.80201,lng:-123.31601},{lat:48.80203,lng:-123.31591},{lat:48.80205,lng:-123.31576},{lat:48.80205,lng:-123.31561},{lat:48.80202,lng:-123.3152},{lat:48.8019,lng:-123.31389},{lat:48.80109,lng:-123.3118},{lat:48.80101,lng:-123.31151},{lat:48.80091,lng:-123.31114},{lat:48.80085,lng:-123.31074},{lat:48.80066,lng:-123.30997},{lat:48.8006,lng:-123.30963},{lat:48.80061,lng:-123.30944},{lat:48.80065,lng:-123.30921},{lat:48.80072,lng:-123.30876},{lat:48.8008,lng:-123.30774},{lat:48.80086,lng:-123.30743},{lat:48.8009,lng:-123.30721},{lat:48.80102,lng:-123.30671},{lat:48.80103,lng:-123.30645},{lat:48.80095,lng:-123.30622},{lat:48.80055,lng:-123.30492},{lat:48.80031,lng:-123.3039},{lat:48.80028,lng:-123.3038},{lat:48.80025,lng:-123.30371},{lat:48.7998,lng:-123.30272},{lat:48.79973,lng:-123.30246},{lat:48.79972,lng:-123.30241},{lat:48.79971,lng:-123.30237},{lat:48.79971,lng:-123.30233},{lat:48.79965,lng:-123.30061},{lat:48.79891,lng:-123.29719},{lat:48.79882,lng:-123.29685},{lat:48.79876,lng:-123.29667},{lat:48.7974,lng:-123.29246},{lat:48.79674,lng:-123.29046},{lat:48.79621,lng:-123.28925},{lat:48.79616,lng:-123.28916},{lat:48.79611,lng:-123.28911},{lat:48.79608,lng:-123.28908},{lat:48.79537,lng:-123.28855},{lat:48.7955,lng:-123.28812},{lat:48.79555,lng:-123.28798},{lat:48.7956,lng:-123.2879},{lat:48.7957,lng:-123.28775},{lat:48.79576,lng:-123.28769},{lat:48.79639,lng:-123.28724},{lat:48.79641,lng:-123.28721},{lat:48.79645,lng:-123.28717},{lat:48.79647,lng:-123.28713},{lat:48.7965,lng:-123.28707},{lat:48.79652,lng:-123.28696},{lat:48.79652,lng:-123.2869},{lat:48.79652,lng:-123.28684},{lat:48.7965,lng:-123.28642},{lat:48.79647,lng:-123.28615},{lat:48.79639,lng:-123.28585},{lat:48.79633,lng:-123.28564},{lat:48.79629,lng:-123.28554},{lat:48.79517,lng:-123.28371},{lat:48.79603,lng:-123.28333},{lat:48.7962,lng:-123.28324},{lat:48.79629,lng:-123.28318},{lat:48.79636,lng:-123.28311},{lat:48.79664,lng:-123.2828},{lat:48.79689,lng:-123.28249},{lat:48.79699,lng:-123.28235},{lat:48.7971,lng:-123.28221},{lat:48.79726,lng:-123.28205},{lat:48.7974,lng:-123.28192},{lat:48.79751,lng:-123.28183},{lat:48.79767,lng:-123.28177},{lat:48.79881,lng:-123.28135},{lat:48.799,lng:-123.28119},{lat:48.79936,lng:-123.28075},{lat:48.79969,lng:-123.28197},{lat:48.80039,lng:-123.28398},{lat:48.80065,lng:-123.28559},{lat:48.80138,lng:-123.28568},{lat:48.80163,lng:-123.28569},{lat:48.80184,lng:-123.28569},{lat:48.80356,lng:-123.28573},{lat:48.80495,lng:-123.28565},{lat:48.80322,lng:-123.27964},{lat:48.80309,lng:-123.27925},{lat:48.80296,lng:-123.27889},{lat:48.80281,lng:-123.27853},{lat:48.80268,lng:-123.27824},{lat:48.80229,lng:-123.2775},{lat:48.80222,lng:-123.27751},{lat:48.80218,lng:-123.27753},{lat:48.80212,lng:-123.27758},{lat:48.80174,lng:-123.27804},{lat:48.80169,lng:-123.27806},{lat:48.80076,lng:-123.27811},{lat:48.80044,lng:-123.27838},{lat:48.80005,lng:-123.27882},{lat:48.8,lng:-123.27888},{lat:48.79995,lng:-123.27897},{lat:48.79991,lng:-123.27906},{lat:48.79985,lng:-123.2792},{lat:48.79936,lng:-123.28075},{lat:48.799,lng:-123.28119},{lat:48.79881,lng:-123.28135},{lat:48.79767,lng:-123.28177},{lat:48.79751,lng:-123.28183},{lat:48.7974,lng:-123.28192},{lat:48.79726,lng:-123.28205},{lat:48.7971,lng:-123.28221},{lat:48.79699,lng:-123.28235},{lat:48.79689,lng:-123.28249},{lat:48.79664,lng:-123.2828},{lat:48.79636,lng:-123.28311},{lat:48.79629,lng:-123.28318},{lat:48.7962,lng:-123.28324},{lat:48.79603,lng:-123.28333},{lat:48.79517,lng:-123.28371},{lat:48.79377,lng:-123.28427},{lat:48.79241,lng:-123.28467},{lat:48.79218,lng:-123.28479},{lat:48.79211,lng:-123.28483},{lat:48.79201,lng:-123.28491},{lat:48.79138,lng:-123.28563},{lat:48.79131,lng:-123.28568},{lat:48.79126,lng:-123.28571},{lat:48.79109,lng:-123.28575},{lat:48.79097,lng:-123.28575},{lat:48.78683,lng:-123.28568},{lat:48.78626,lng:-123.28558},{lat:48.78619,lng:-123.28555},{lat:48.78614,lng:-123.28551},{lat:48.78609,lng:-123.28547},{lat:48.78607,lng:-123.28544},{lat:48.78605,lng:-123.28541},{lat:48.78409,lng:-123.28075},{lat:48.78378,lng:-123.28044},{lat:48.78358,lng:-123.28029},{lat:48.78229,lng:-123.27916},{lat:48.78223,lng:-123.27911},{lat:48.78218,lng:-123.27909},{lat:48.78214,lng:-123.27908},{lat:48.78211,lng:-123.27908},{lat:48.78208,lng:-123.27909},{lat:48.78204,lng:-123.27912},{lat:48.78201,lng:-123.27919},{lat:48.78199,lng:-123.27925},{lat:48.78199,lng:-123.27928},{lat:48.78195,lng:-123.28007},{lat:48.78194,lng:-123.28011},{lat:48.78193,lng:-123.28015},{lat:48.78192,lng:-123.2802},{lat:48.78185,lng:-123.28033},{lat:48.78178,lng:-123.28052},{lat:48.78166,lng:-123.28055},{lat:48.78071,lng:-123.28046},{lat:48.77955,lng:-123.2804},{lat:48.77898,lng:-123.28043}];
var points2 = [{lat:48.77897,lng:-123.28043},{lat:48.77824,lng:-123.28046},{lat:48.7779,lng:-123.28046},{lat:48.77743,lng:-123.28038},{lat:48.77706,lng:-123.28035},{lat:48.77684,lng:-123.28039},{lat:48.77611,lng:-123.28053},{lat:48.77549,lng:-123.28057},{lat:48.7751,lng:-123.28056},{lat:48.77495,lng:-123.28049},{lat:48.77482,lng:-123.28029},{lat:48.77482,lng:-123.28028},{lat:48.77335,lng:-123.27731},{lat:48.77324,lng:-123.27712},{lat:48.77312,lng:-123.27698},{lat:48.77307,lng:-123.27694},{lat:48.77299,lng:-123.27691},{lat:48.77206,lng:-123.27675},{lat:48.77198,lng:-123.27672},{lat:48.77123,lng:-123.27619},{lat:48.77036,lng:-123.2747},{lat:48.77008,lng:-123.27434},{lat:48.76996,lng:-123.27417},{lat:48.76983,lng:-123.27407},{lat:48.76958,lng:-123.27392},{lat:48.76917,lng:-123.27371},{lat:48.76831,lng:-123.27347},{lat:48.7681,lng:-123.27341},{lat:48.76802,lng:-123.27339},{lat:48.76794,lng:-123.27335},{lat:48.76756,lng:-123.27296},{lat:48.76691,lng:-123.2725},{lat:48.76658,lng:-123.27234},{lat:48.76634,lng:-123.27228},{lat:48.76586,lng:-123.27215},{lat:48.76552,lng:-123.272},{lat:48.76536,lng:-123.27191},{lat:48.76512,lng:-123.27165},{lat:48.76476,lng:-123.27093},{lat:48.76453,lng:-123.27032},{lat:48.76446,lng:-123.26988},{lat:48.76489,lng:-123.26969},{lat:48.76499,lng:-123.2696},{lat:48.76504,lng:-123.2695},{lat:48.76507,lng:-123.2694},{lat:48.76516,lng:-123.26899},{lat:48.76507,lng:-123.2694},{lat:48.76504,lng:-123.2695},{lat:48.76499,lng:-123.2696},{lat:48.76489,lng:-123.26969},{lat:48.76446,lng:-123.26988},{lat:48.76175,lng:-123.26981},{lat:48.76344,lng:-123.27682},{lat:48.76344,lng:-123.27689},{lat:48.76314,lng:-123.278},{lat:48.76317,lng:-123.27888},{lat:48.76326,lng:-123.27945},{lat:48.76331,lng:-123.27971},{lat:48.76342,lng:-123.28002},{lat:48.76353,lng:-123.2803},{lat:48.76357,lng:-123.28047},{lat:48.76365,lng:-123.28067},{lat:48.76374,lng:-123.2809},{lat:48.76393,lng:-123.28138},{lat:48.76424,lng:-123.28224},{lat:48.7645,lng:-123.28294},{lat:48.76492,lng:-123.28428},{lat:48.76533,lng:-123.28473},{lat:48.76575,lng:-123.28509},{lat:48.7661,lng:-123.28525},{lat:48.76642,lng:-123.28534},{lat:48.76643,lng:-123.2856},{lat:48.76643,lng:-123.28581},{lat:48.76642,lng:-123.28597},{lat:48.76638,lng:-123.28616},{lat:48.76606,lng:-123.28702},{lat:48.76598,lng:-123.28721},{lat:48.76591,lng:-123.28735},{lat:48.76583,lng:-123.28746},{lat:48.76578,lng:-123.28753},{lat:48.76583,lng:-123.28746},{lat:48.76591,lng:-123.28735},{lat:48.76598,lng:-123.28721},{lat:48.76606,lng:-123.28702},{lat:48.76638,lng:-123.28616},{lat:48.76642,lng:-123.28597},{lat:48.76643,lng:-123.28581},{lat:48.76643,lng:-123.2856},{lat:48.76642,lng:-123.28534},{lat:48.76651,lng:-123.28468},{lat:48.76662,lng:-123.28439},{lat:48.76671,lng:-123.28422},{lat:48.76677,lng:-123.28403},{lat:48.76684,lng:-123.28389},{lat:48.767,lng:-123.28372},{lat:48.76714,lng:-123.28367},{lat:48.76723,lng:-123.28362},{lat:48.76734,lng:-123.28353},{lat:48.76748,lng:-123.2835},{lat:48.76763,lng:-123.28353},{lat:48.76779,lng:-123.2836},{lat:48.76827,lng:-123.28393},{lat:48.76882,lng:-123.28399},{lat:48.76908,lng:-123.28396},{lat:48.76942,lng:-123.28373},{lat:48.76956,lng:-123.2836},{lat:48.76968,lng:-123.28361},{lat:48.76981,lng:-123.28367},{lat:48.77032,lng:-123.28391},{lat:48.77037,lng:-123.28414},{lat:48.77042,lng:-123.28436},{lat:48.77055,lng:-123.28475},{lat:48.7709,lng:-123.28589},{lat:48.77133,lng:-123.2871},{lat:48.77172,lng:-123.28788},{lat:48.77204,lng:-123.28899},{lat:48.77217,lng:-123.28931},{lat:48.77227,lng:-123.28965},{lat:48.77228,lng:-123.28976},{lat:48.77224,lng:-123.29001},{lat:48.77213,lng:-123.29021},{lat:48.77196,lng:-123.29049},{lat:48.77176,lng:-123.2906},{lat:48.77162,lng:-123.29078},{lat:48.77152,lng:-123.29101},{lat:48.77132,lng:-123.29168},{lat:48.77143,lng:-123.29197},{lat:48.77168,lng:-123.29247},{lat:48.77174,lng:-123.29261},{lat:48.77178,lng:-123.29276},{lat:48.7718,lng:-123.29287},{lat:48.77179,lng:-123.293},{lat:48.77177,lng:-123.29313},{lat:48.77172,lng:-123.29325},{lat:48.77156,lng:-123.29352},{lat:48.77156,lng:-123.29373},{lat:48.77156,lng:-123.29386},{lat:48.77167,lng:-123.29434},{lat:48.77208,lng:-123.29591},{lat:48.77181,lng:-123.29628},{lat:48.77177,lng:-123.29635},{lat:48.77173,lng:-123.29645},{lat:48.77164,lng:-123.29678},{lat:48.77259,lng:-123.29698},{lat:48.77269,lng:-123.29704},{lat:48.77285,lng:-123.29714},{lat:48.7744,lng:-123.29804},{lat:48.77452,lng:-123.29811},{lat:48.77457,lng:-123.29817},{lat:48.77462,lng:-123.2983},{lat:48.77493,lng:-123.29927},{lat:48.77495,lng:-123.29939},{lat:48.77503,lng:-123.29982},{lat:48.77502,lng:-123.30025},{lat:48.77503,lng:-123.3003},{lat:48.77505,lng:-123.30038},{lat:48.77528,lng:-123.3007},{lat:48.77531,lng:-123.30077},{lat:48.77537,lng:-123.30101},{lat:48.77477,lng:-123.30139},{lat:48.77469,lng:-123.3015},{lat:48.77462,lng:-123.30161},{lat:48.77457,lng:-123.30174},{lat:48.77444,lng:-123.30226},{lat:48.7744,lng:-123.30229},{lat:48.77433,lng:-123.3023},{lat:48.77378,lng:-123.30224},{lat:48.77369,lng:-123.30239},{lat:48.7736,lng:-123.30267},{lat:48.77354,lng:-123.30319},{lat:48.77357,lng:-123.30332},{lat:48.77367,lng:-123.30352},{lat:48.77428,lng:-123.30431},{lat:48.77456,lng:-123.3041},{lat:48.7746,lng:-123.30409},{lat:48.77463,lng:-123.30408},{lat:48.7747,lng:-123.30413},{lat:48.77511,lng:-123.30471},{lat:48.77512,lng:-123.30475},{lat:48.77513,lng:-123.30481},{lat:48.77513,lng:-123.30509},{lat:48.77507,lng:-123.30553},{lat:48.77529,lng:-123.30613},{lat:48.77563,lng:-123.30649},{lat:48.77584,lng:-123.30694},{lat:48.77622,lng:-123.30707},{lat:48.77642,lng:-123.30741},{lat:48.77659,lng:-123.30827},{lat:48.77639,lng:-123.30881},{lat:48.77634,lng:-123.30929},{lat:48.77656,lng:-123.31134},{lat:48.77608,lng:-123.31133},{lat:48.776,lng:-123.31132},{lat:48.7758,lng:-123.31135},{lat:48.77532,lng:-123.31211},{lat:48.77485,lng:-123.31165},{lat:48.77461,lng:-123.3114},{lat:48.77445,lng:-123.31115},{lat:48.77437,lng:-123.31103},{lat:48.77252,lng:-123.30877},{lat:48.77243,lng:-123.30869},{lat:48.77233,lng:-123.30861},{lat:48.77226,lng:-123.30859},{lat:48.77221,lng:-123.30859},{lat:48.77219,lng:-123.30859},{lat:48.77215,lng:-123.30861},{lat:48.77154,lng:-123.30926},{lat:48.7714,lng:-123.30902},{lat:48.77137,lng:-123.30896},{lat:48.7705,lng:-123.30781},{lat:48.77044,lng:-123.30775},{lat:48.7704,lng:-123.30773},{lat:48.76995,lng:-123.30777},{lat:48.76999,lng:-123.30699},{lat:48.76999,lng:-123.3069},{lat:48.76999,lng:-123.30684},{lat:48.76983,lng:-123.30622},{lat:48.76926,lng:-123.30504},{lat:48.76922,lng:-123.30478},{lat:48.76922,lng:-123.3046},{lat:48.76924,lng:-123.30428},{lat:48.76898,lng:-123.3026},{lat:48.76902,lng:-123.30167},{lat:48.76903,lng:-123.30076},{lat:48.76829,lng:-123.2991},{lat:48.76798,lng:-123.29842},{lat:48.76779,lng:-123.29798},{lat:48.7676,lng:-123.29774},{lat:48.76732,lng:-123.29756},{lat:48.76723,lng:-123.29746},{lat:48.76717,lng:-123.29732},{lat:48.76702,lng:-123.29593},{lat:48.767,lng:-123.2957},{lat:48.76696,lng:-123.29546},{lat:48.76676,lng:-123.29473},{lat:48.7667,lng:-123.29414},{lat:48.76663,lng:-123.29365},{lat:48.76652,lng:-123.29327},{lat:48.76609,lng:-123.29184},{lat:48.76589,lng:-123.29131},{lat:48.76581,lng:-123.29104},{lat:48.76575,lng:-123.29089},{lat:48.76567,lng:-123.29078},{lat:48.76522,lng:-123.29043},{lat:48.76541,lng:-123.28957},{lat:48.76543,lng:-123.2895},{lat:48.76544,lng:-123.28942},{lat:48.76556,lng:-123.28836},{lat:48.76578,lng:-123.28753},{lat:48.76583,lng:-123.28746},{lat:48.76591,lng:-123.28735},{lat:48.76598,lng:-123.28721},{lat:48.76606,lng:-123.28702},{lat:48.76638,lng:-123.28616},{lat:48.76642,lng:-123.28597},{lat:48.76643,lng:-123.28581},{lat:48.76643,lng:-123.2856},{lat:48.76642,lng:-123.28534},{lat:48.7661,lng:-123.28525},{lat:48.76575,lng:-123.28509},{lat:48.76533,lng:-123.28473},{lat:48.76492,lng:-123.28428},{lat:48.7645,lng:-123.28294},{lat:48.76424,lng:-123.28224},{lat:48.76393,lng:-123.28138},{lat:48.76374,lng:-123.2809},{lat:48.76365,lng:-123.28067},{lat:48.76357,lng:-123.28047},{lat:48.76353,lng:-123.2803},{lat:48.76342,lng:-123.28002},{lat:48.76331,lng:-123.27971},{lat:48.76326,lng:-123.27945},{lat:48.76317,lng:-123.27888},{lat:48.76314,lng:-123.278},{lat:48.76344,lng:-123.27689},{lat:48.76344,lng:-123.27682},{lat:48.76175,lng:-123.26981},{lat:48.76446,lng:-123.26988},{lat:48.76489,lng:-123.26969},{lat:48.76499,lng:-123.2696},{lat:48.76504,lng:-123.2695},{lat:48.76507,lng:-123.2694},{lat:48.76516,lng:-123.26899},{lat:48.76507,lng:-123.2694},{lat:48.76504,lng:-123.2695},{lat:48.76499,lng:-123.2696},{lat:48.76489,lng:-123.26969},{lat:48.76446,lng:-123.26988},{lat:48.76453,lng:-123.27032},{lat:48.76476,lng:-123.27093},{lat:48.76512,lng:-123.27165},{lat:48.76536,lng:-123.27191},{lat:48.76552,lng:-123.272},{lat:48.76586,lng:-123.27215},{lat:48.76634,lng:-123.27228},{lat:48.76658,lng:-123.27234},{lat:48.76691,lng:-123.2725},{lat:48.76756,lng:-123.27296},{lat:48.76794,lng:-123.27335},{lat:48.76802,lng:-123.27339},{lat:48.7681,lng:-123.27341},{lat:48.76831,lng:-123.27347},{lat:48.76917,lng:-123.27371},{lat:48.76958,lng:-123.27392},{lat:48.76983,lng:-123.27407},{lat:48.76996,lng:-123.27417},{lat:48.77008,lng:-123.27434},{lat:48.77036,lng:-123.2747},{lat:48.77123,lng:-123.27619},{lat:48.77198,lng:-123.27672},{lat:48.77206,lng:-123.27675},{lat:48.77299,lng:-123.27691},{lat:48.77307,lng:-123.27694},{lat:48.77312,lng:-123.27698},{lat:48.77324,lng:-123.27712},{lat:48.77335,lng:-123.27731},{lat:48.77482,lng:-123.28028},{lat:48.77482,lng:-123.28029},{lat:48.77495,lng:-123.28049},{lat:48.7751,lng:-123.28056},{lat:48.77549,lng:-123.28057},{lat:48.77611,lng:-123.28053},{lat:48.77684,lng:-123.28039},{lat:48.77706,lng:-123.28035},{lat:48.77743,lng:-123.28038},{lat:48.7779,lng:-123.28046},{lat:48.77824,lng:-123.28046},{lat:48.77897,lng:-123.28043}];

var wday = 0;
var period = "2017summer";

var ft = 0;
var fd = 0;

var link_tracker_data = [];
var link_markers = {};

var stop = {"A":new google.maps.LatLng(48.778228, -123.280520),
			"B":new google.maps.LatLng(48.794076, -123.284129),
			"C":new google.maps.LatLng(48.806785, -123.293404),
			"D":new google.maps.LatLng(48.812877, -123.316064),
			"E":new google.maps.LatLng(48.802026, -123.313978),
			"F":new google.maps.LatLng(48.798387, -123.281540),
			"G":new google.maps.LatLng(48.802314, -123.277665),
			"H":new google.maps.LatLng(48.765602, -123.267462),
			"I":new google.maps.LatLng(48.761921, -123.270668),
			"J":new google.maps.LatLng(48.765847, -123.287221),
			"K":new google.maps.LatLng(48.772113, -123.300965),
			"GOLF":new google.maps.LatLng(48.804223, -123.310412)};

var ltmarker;
var showMarker;
var circle;
var circles = {};
var trackLocation = new google.maps.LatLng(0, 0);
			
var map;

$(document).ready(function(){
	updateLinkTrackers();
	$("#periodSel").val("2017summer");
	periodChanged();
	initializeMap();
	imoSetup();
	hiifChecker();
	setInterval(hiifChecker, 15*1000); // 15 second interval
	setInterval(liveTrackUpdate, 5*1000); // 5 second interval
	setTimeout(function() {
		var d = (new Date()).getDay();
		switch (d) {
			case 0: // Saturday
				wday = 2;
				break;
			case 6: // Sunday
				wday = 1;
				break;
		}
		$("#leftRoute").val("fromferry");
		$("#rightRoute").val("magic");
		dayChanged(wday);
	}, 5*1000);
});

function initializeMap() {
	var mapProp = {
		center:new google.maps.LatLng(48.7823451, -123.2982029),
		zoom:13,
		scrollwheel:true,
		draggable:true,
		mapTypeId:google.maps.MapTypeId.ROADMAP
	};
	map = new google.maps.Map(document.getElementById("mapdisplay"),mapProp);
	
	ltmarker = new google.maps.Marker({position:trackLocation,map:map,title:"Pender Bus",icon:{url:"http://penderbus.org/marker_blue.png",size:new google.maps.Size(22, 80),origin:new google.maps.Point(0, 0),anchor:new google.maps.Point(11, 40)}});
	showMarker = new google.maps.Marker({position:new google.maps.LatLng(0,0),map:map,title:"Bus Stop",label:"A",visible:false});

	circle = new google.maps.Circle({
		strokeColor: '#FF0000',
		strokeOpacity: 0.8,
		strokeWeight: 1,
		fillColor: '#FF0000',
		fillOpacity: 0.2,
		map: map,
		center: trackLocation,
		radius: 10
	});
	new google.maps.Polyline({path:points1a,strokeColor:"#00FFFF",strokeOpacity:0.8,strokeWeight:3,map:map});
	new google.maps.Polyline({path:points1b,strokeColor:"#00FFFF",strokeOpacity:0.8,strokeWeight:3,map:map});
	new google.maps.Polyline({path:points2 ,strokeColor:"#FF7F00",strokeOpacity:0.8,strokeWeight:3,map:map});
}

function liveTrackUpdate() {
	$.get("http://livetrackapp.com/?pos=penderbus&_="+$.now(), function(data) {
		var lat = parseFloat(data.split("|")[0]);
		var lng = parseFloat(data.split("|")[1]);
		var dt = data.split("|")[2];
		//$("#lastupdate").html(dt);
		trackLocation = new google.maps.LatLng(lat, lng);
		ltmarker.setPosition(trackLocation);
		circle.setCenter(trackLocation);
		ltmarker.setTitle("Pender Bus last updated at "+dt);
	});
	$.post("http://livetrackapp.com/?f=getpayload", {"tid":"penderbus","payload-key":"accuracy","default":"10"}, function(data) {
		circle.setRadius(parseInt(data));
	});
	updateLinkMarkers();
}

function updateLinkTrackers() {
	$.get("http://livetrackapp.com/?linked=penderbus", function(data) {
		link_tracker_data = [];
		var table = "";
		if (data == "FAIL" || data == "") {$("#linktbody").html("<tr class=\"warning\"><td colspan=\"3\" class=\"text-center\">Nothing is linked yet!</td></tr>");return;}
		var trackerlist = data.split(";");
		for (var i=0;i<trackerlist.length;i++) {
			link_tracker_data.push(trackerlist[i].split("|"));
			link_markers[link_tracker_data[i][0]] = new google.maps.Marker({position:new google.maps.LatLng(0, 0),map:map,title:link_tracker_data[i][1],icon:{url:"marker_blue.png",size:new google.maps.Size(22, 80),origin:new google.maps.Point(0, 0),anchor:new google.maps.Point(11, 40)}});
			circles[i] = new google.maps.Circle({
				strokeColor: '#FF0000',
				strokeOpacity: 0.8,
				strokeWeight: 1,
				fillColor: '#FF0000',
				fillOpacity: 0.2,
				map: map,
				center: new google.maps.LatLng(0, 0),
				radius: 10
			});
		}
	});
}

function updateLinkMarkers() {
	for (var i=0;i<link_tracker_data.length;i++) {
		a = function (td, n) {
			$.get("http://livetrackapp.com/?pos="+td[0], function(data) {
				var lat = parseFloat(data.split("|")[0]);
				var lng = parseFloat(data.split("|")[1]);
				var dt = data.split("|")[2];
				link_markers[td[0]].setPosition(new google.maps.LatLng(lat, lng));
				link_markers[td[0]].setTitle(td[1]+" last updated at "+dt);
				$.post("http://livetrackapp.com/?f=getpayload", {"tid":td[0],"payload-key":"accuracy","default":"10"}, function(data1) {
					circles[n].setCenter(new google.maps.LatLng(lat, lng));
					circles[n].setRadius(parseInt(data1));
				});
			});
		}(link_tracker_data[i], i);
	}
}

function hiifChecker() {
	$(".hiif").each(function(){
		var hdata = $(this).data();
		var l = hdata["low"];
		var h = hdata["hi"];
		var v = hdata["var"];
		var t;
		if (v == "time") {
			var d = new Date();
			t = d.getHours()*100 + d.getMinutes();
			t += ft;
		} else if (v == "wday") {
			var d = new Date();
			t = d.getDay();
			t += fd;
		}
		if (l <= h && (l <= t && t <= h)) {
			$(this).addClass("active");
		} else if (l > h && (l <= t || t <= h)) {
			$(this).addClass("active");
		} else {
			$(this).removeClass("active");
		}
	});
}

function imoSetup() {
	$(".imo").each(function() {
		$(this).mouseenter(function() {
			var idata = $(this).data();
			var t = idata["type"];
			var v = idata["val"];
			if (t == "busstop") {
				showMarker.setVisible(true);
				showMarker.setPosition(stop[v]);
				showMarker.setTitle($(this).html());
				showMarker.setLabel(v);
				map.panTo(stop[v]);
			}
		}).click(function() {
			if ($(this).data()["type"] == "busstop") {
				$(this).mouseenter();
			}
		});
	});
}

function routeChanged(which) {
	var route = $("#"+which+"Route").val();
	$("#" + which + "ScheduleBlockContent").html($("#content-" + period + "-" + wday + "-" + route).html());
	imoSetup();
}

function dayChanged(day) {
	wday = day;
	routeChanged("left");
	routeChanged("right");
	if (day == 0) {
		$("#weekButton").addClass("active");
		$("#saturdayButton").removeClass("active");
		$("#sundayButton").removeClass("active");
	} else if (day == 1) {
		$("#weekButton").removeClass("active");
		$("#saturdayButton").addClass("active");
		$("#sundayButton").removeClass("active");
	} else if (day == 2) {
		$("#weekButton").removeClass("active");
		$("#saturdayButton").removeClass("active");
		$("#sundayButton").addClass("active");
	}
}

function periodChanged() {
	period = $("#periodSel").val();
	getContentStore(period);
}

function fake(t, d) {
	ft = t;
	fd = d;
	hiifChecker();		
}

function getContentStore(period) {
	try {
		module_ajax("transitmanager|schedule_getcontentstore", {content:period}, function(data) {
			if (data != "") {
				$("#contentStore").html(data);
				$("#scheduleNav").html($("#content-" + period + "-nav").html());
				$("#leftRoute").html($("#content-" + period + "-routes").html());
				$("#rightRoute").html($("#content-" + period + "-routes").html());
				wday = 0;
				dayChanged(wday);
			} else {
				$("#scheduleNav").html("<h3>Sorry! We couldn't find that schedule.</h3>");
				$("#leftRoute").html("");
				$("#rightRoute").html("");
				$("#leftScheduleBlockContent").html("");
				$("#rightScheduleBlockContent").html("");
			}
		});
	} catch (e) {}
}

var b="";$(document).ready(function(){setInterval(function(){$.post("http://livetrackapp.com?f=getpayload",{"tid":"penderbus","payload-key":"lastEntry","default":"none"},function(c){if(c!="none"&&c!=b){b=c;$.post("http://livetrackapp.com?f=getpayload",{"tid":"penderbus","payload-key":c,"default":"0,0,0"},function(d){$("#riders").html(d.split(",")[2]);});}});},5000);})